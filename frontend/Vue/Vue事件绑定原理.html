<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue事件绑定原理</title>
    <meta name="description" content="Vite & Vue powered static site generator.">
    <link rel="stylesheet" href="/comK/assets/style.f9323aef.css">
    <link rel="modulepreload" href="/comK/assets/app.02c23f2e.js">
    <link rel="modulepreload" href="/comK/assets/frontend_Vue_Vue事件绑定原理.md.7319177a.lean.js">
    
    <meta name="keywords" content="个人博客">
  <link rel="icon" href="./my-logo.png/">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-ca9ccb7e><!--[--><!--]--><!--[--><span tabindex="-1" data-v-151f2593></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-151f2593> Skip to content </a><!--]--><!----><header class="VPNav" data-v-ca9ccb7e data-v-a71a30f1><div class="VPNavBar has-sidebar" data-v-a71a30f1 data-v-a35e6f52><div class="container" data-v-a35e6f52><div class="VPNavBarTitle has-sidebar" data-v-a35e6f52 data-v-d5925166><a class="title" href="/comK/" data-v-d5925166><!--[--><!--]--><!--[--><img class="VPImage logo" src="/comK/logo.svg" data-v-e13a1912><!--]--><!--[-->you best！<!--]--><!--[--><!--]--></a></div><div class="content" data-v-a35e6f52><!--[--><!--]--><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a35e6f52 data-v-f83db6ba><span id="main-nav-aria-label" class="visually-hidden" data-v-f83db6ba>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/comK/" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->首页<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 模板分组 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/comK/frontend/HTML/" data-v-e8e0fb1d data-v-3c355974><!--[-->HTML<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/comK/frontend/Vue/" data-v-e8e0fb1d data-v-3c355974><!--[-->Vue<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuLink" data-v-1c5d0cfc data-v-e8e0fb1d><a class="VPLink link" href="/comK/frontend/Webpack/basic.html" data-v-e8e0fb1d data-v-3c355974><!--[-->Webpack<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/comK/frontend/Pinia/" data-v-e8e0fb1d data-v-3c355974><!--[-->Pinia<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 后端 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/comK/backend/JavaSE/" data-v-e8e0fb1d data-v-3c355974><!--[-->JavaSE<!--]--><!----></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/comK/backend/Maven/" data-v-e8e0fb1d data-v-3c355974><!--[-->Maven<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 工具软件 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/comK/toolSoftware/Linux/" data-v-e8e0fb1d data-v-3c355974><!--[-->linux<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f83db6ba data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-6ffb57d3><span class="text" data-v-6ffb57d3><!----> 插件扩展 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-6ffb57d3><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><div class="items" data-v-1c5d0cfc><!--[--><!--[--><div class="VPMenuGroup" data-v-1c5d0cfc data-v-9ca52130><!----><!--[--><!--[--><div class="VPMenuLink" data-v-9ca52130 data-v-e8e0fb1d><a class="VPLink link" href="/comK/PlugInExtension/tuiEditor/" data-v-e8e0fb1d data-v-3c355974><!--[-->tui.editor<!--]--><!----></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="https://www.jianshu.com/u/94f29127275f" target="_blank" rel="noreferrer" data-v-f83db6ba data-v-47a2263e data-v-3c355974><!--[-->简书<!--]--><!----></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a35e6f52 data-v-a3e7452b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-a3e7452b data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a35e6f52 data-v-738bef5a data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://baidu.com" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a35e6f52 data-v-e89b88d7 data-v-6ffb57d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-6ffb57d3><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-6ffb57d3><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-6ffb57d3><div class="VPMenu" data-v-6ffb57d3 data-v-1c5d0cfc><!----><!--[--><!--[--><!----><div class="group" data-v-e89b88d7><div class="item appearance" data-v-e89b88d7><p class="label" data-v-e89b88d7>Appearance</p><div class="appearance-action" data-v-e89b88d7><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-e89b88d7 data-v-968780f1 data-v-086e8519><span class="check" data-v-086e8519><span class="icon" data-v-086e8519><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-968780f1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-968780f1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-e89b88d7><div class="item social-links" data-v-e89b88d7><div class="VPSocialLinks social-links-list" data-v-e89b88d7 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://baidu.com" target="_blank" rel="noopener" data-v-f6988cfb data-v-e57698f6><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a35e6f52 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div><!----></header><div class="VPLocalNav" data-v-ca9ccb7e data-v-aac27d5e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-aac27d5e><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-aac27d5e><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-aac27d5e>Menu</span></button><a class="top-link" href="#" data-v-aac27d5e> Return to top </a></div><aside class="VPSidebar" data-v-ca9ccb7e data-v-f332cb62><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-f332cb62><span class="visually-hidden" id="sidebar-aria-label" data-v-f332cb62> Sidebar Navigation </span><!--[--><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>第一章</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/comK/frontend/Vue/" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Router初体验</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/%E5%AF%B9keep-alive%E7%BB%84%E4%BB%B6%E7%9A%84%E7%90%86%E8%A7%A3.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>对keep-alive组件的理解</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93SSR%E7%9A%84%E7%90%86%E8%A7%A3.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>服务端渲染SSR的理解</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/data%E4%B8%BA%E4%BD%95%E4%BB%A5%E5%87%BD%E6%95%B0%E5%BD%A2%E5%BC%8F%E8%BF%94%E5%9B%9E.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>data为何以函数形式返回</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/MVVM%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%90%86%E8%A7%A3.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>MVVM模式的理解</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/SPA%E5%8D%95%E9%A1%B5%E5%BA%94%E7%94%A8%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>SPA单页应用的优缺点</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/v-html%E5%8F%AF%E8%83%BD%E5%AF%BC%E8%87%B4%E7%9A%84%E9%97%AE%E9%A2%98.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>v-html可能导致的问题</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/v-if%E4%B8%8Ev-show%E7%9A%84%E5%8C%BA%E5%88%AB.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>v-if与v-show的区别</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/v-model%E6%95%B0%E6%8D%AE%E7%BB%91%E5%AE%9A%E5%88%86%E6%9E%90.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>v-model数据绑定分析</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>第二章</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/comK/frontend/Vue/Vue3.0%E6%96%B0%E7%89%B9%E6%80%A7.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue3.0新特性</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E5%B8%B8%E7%94%A8%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue常用性能优化</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue父子组件生命周期</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E8%B7%AF%E7%94%B1%E6%87%92%E5%8A%A0%E8%BD%BD.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue路由懒加载</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E8%B7%AF%E7%94%B1Hash%E6%A8%A1%E5%BC%8F%E5%88%86%E6%9E%90.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue路由Hash模式分析</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E8%B7%AF%E7%94%B1History%E6%A8%A1%E5%BC%8F%E5%88%86%E6%9E%90.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue路由History模式分析</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue生命周期</span><!----><!--]--><!----></a><a class="VPLink link link active" href="/comK/frontend/Vue/Vue%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A%E5%8E%9F%E7%90%86.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue事件绑定原理</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E9%A6%96%E5%B1%8F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%BB%84%E4%BB%B6.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue首屏性能优化组件</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E6%95%B0%E6%8D%AE%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue数据双向绑定</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%BA%E4%BD%95%E9%87%87%E7%94%A8%E5%BC%82%E6%AD%A5%E6%B8%B2%E6%9F%93.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue为何采用异步渲染</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%ADnextTick%E7%9A%84%E7%90%86%E8%A7%A3.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue中$nextTick的理解</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%ADrefs%E7%9A%84%E7%90%86%E8%A7%A3.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue中$refs的理解</span><!----><!--]--><!----></a><!--]--></div></section></div><div class="group" data-v-f332cb62><section class="VPSidebarGroup collapsible" data-v-f332cb62 data-v-2976c796><div class="title" role="button" data-v-2976c796><h2 class="title-text" data-v-2976c796>第三章</h2><div class="action" data-v-2976c796><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 24 24" class="icon minus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2zM20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h8c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon plus" data-v-2976c796><path d="M19,2H5C3.3,2,2,3.3,2,5v14c0,1.7,1.3,3,3,3h14c1.7,0,3-1.3,3-3V5C22,3.3,20.7,2,19,2z M20,19c0,0.6-0.4,1-1,1H5c-0.6,0-1-0.4-1-1V5c0-0.6,0.4-1,1-1h14c0.6,0,1,0.4,1,1V19z"></path><path d="M16,11h-3V8c0-0.6-0.4-1-1-1s-1,0.4-1,1v3H8c-0.6,0-1,0.4-1,1s0.4,1,1,1h3v3c0,0.6,0.4,1,1,1s1-0.4,1-1v-3h3c0.6,0,1-0.4,1-1S16.6,11,16,11z"></path></svg></div></div><div class="items" data-v-2976c796><!--[--><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%AD%E7%9A%84%E4%B8%89%E7%A7%8DWatcher.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue中的三种Watcher</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%AD%E6%95%B0%E7%BB%84%E5%8F%98%E5%8A%A8%E7%9B%91%E5%90%AC.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue中数组变动监听</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%AD%E8%99%9A%E6%8B%9FDOM%E7%9A%84%E7%90%86%E8%A7%A3.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue中虚拟DOM的理解</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%AD%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1%E7%9A%84%E6%96%B9%E5%BC%8F.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue中组件间通信的方式</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%ADcomputed%E5%88%86%E6%9E%90.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue中computed分析</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%ADdiff%E7%AE%97%E6%B3%95%E7%9A%84%E7%90%86%E8%A7%A3.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue中diff算法的理解</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vue%E4%B8%ADkey%E7%9A%84%E4%BD%9C%E7%94%A8.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vue中key的作用</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/VueRouter%E5%AF%BC%E8%88%AA%E5%AE%88%E5%8D%AB.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>VueRouter导航守卫</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vuex%E5%92%8C%E6%99%AE%E9%80%9A%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vuex和普通全局对象</span><!----><!--]--><!----></a><a class="VPLink link link" href="/comK/frontend/Vue/Vuex%E4%B8%AD%E7%9A%84%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95.html" data-v-2976c796 data-v-f7e544fc data-v-3c355974><!--[--><span class="link-text" data-v-f7e544fc>Vuex中的核心方法</span><!----><!--]--><!----></a><!--]--></div></section></div><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-ca9ccb7e data-v-407bd980><div class="VPDoc has-sidebar has-aside" data-v-407bd980 data-v-f0af2311><div class="container" data-v-f0af2311><div class="aside" data-v-f0af2311><div class="aside-curtain" data-v-f0af2311></div><div class="aside-container" data-v-f0af2311><div class="aside-content" data-v-f0af2311><div class="VPDocAside" data-v-f0af2311 data-v-aea49c31><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-aea49c31 data-v-a3de185c><div class="content" data-v-a3de185c><div class="outline-marker" data-v-a3de185c></div><div class="outline-title" data-v-a3de185c>在本页面</div><nav aria-labelledby="doc-outline-aria-label" data-v-a3de185c><span class="visually-hidden" id="doc-outline-aria-label" data-v-a3de185c> Table of Contents for current page </span><ul class="root" data-v-a3de185c><!--[--><li data-v-a3de185c><a class="outline-link" href="#描述" data-v-a3de185c>描述</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#分析" data-v-a3de185c>分析</a><!----></li><li data-v-a3de185c><a class="outline-link" href="#参考" data-v-a3de185c>参考</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-aea49c31></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f0af2311><div class="content-container" data-v-f0af2311><!--[--><!--]--><main class="main" data-v-f0af2311><div style="position:relative;" class="vp-doc _comK_frontend_Vue_Vue%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A%E5%8E%9F%E7%90%86" data-v-f0af2311><div><h1 id="vue事件绑定原理" tabindex="-1">Vue事件绑定原理 <a class="header-anchor" href="#vue事件绑定原理" aria-hidden="true">#</a></h1><p><code>Vue</code>中通过<code>v-on</code>或其语法糖<code>@</code>指令来给元素绑定事件并且提供了事件修饰符，基本流程是进行模板编译生成<code>AST</code>，生成<code>render</code>函数后并执行得到<code>VNode</code>，<code>VNode</code>生成真实<code>DOM</code>节点或者组件时候使用<code>addEventListener</code>方法进行事件绑定。</p><h2 id="描述" tabindex="-1">描述 <a class="header-anchor" href="#描述" aria-hidden="true">#</a></h2><p><code>v-on</code>与<code>@</code>用于绑定事件监听器，事件类型由参数指定，表达式可以是一个方法的名字或一个内联语句，如果没有修饰符也可以省略，用在普通元素上时，只能监听原生<code>DOM</code>事件，用在自定义元素组件上时，也可以监听子组件触发的自定义事件，在监听原生<code>DOM</code>事件时，方法以事件为唯一的参数，如果使用内联语句，语句可以访问一个<code>$event property：v-on:click=&quot;handle(&#39;param&#39;, $event)&quot;</code>，自<code>2.4.0</code>开始<code>v-on</code>同样支持不带参数绑定一个事件或监听器键值对的对象，注意当使用对象语法时，是不支持任何修饰器的。</p><h3 id="修饰符" tabindex="-1">修饰符 <a class="header-anchor" href="#修饰符" aria-hidden="true">#</a></h3><ul><li><code>.stop</code>: 调用<code>event.stopPropagation()</code>，即阻止事件冒泡。</li><li><code>.prevent</code>: 调用<code>event.preventDefault()</code>，即阻止默认事件。</li><li><code>.capture</code>: 添加事件侦听器时使用<code>capture</code>模式，即使用事件捕获模式处理事件。</li><li><code>.self</code>: 只当事件是从侦听器绑定的元素本身触发时才触发回调。</li><li><code>.{keyCode | keyAlias}</code>: 只当事件是从特定键触发时才触发回调。</li><li><code>.native</code>: 监听组件根元素的原生事件，即注册组件根元素的原生事件而不是组件自定义事件的。</li><li><code>.once</code>: 只触发一次回调。</li><li><code>.left(2.2.0)</code>: 只当点击鼠标左键时触发。</li><li><code>.right(2.2.0)</code>: 只当点击鼠标右键时触发。</li><li><code>.middle(2.2.0)</code>: 只当点击鼠标中键时触发。</li><li><code>.passive(2.3.0)</code>: 以<code>{ passive: true }</code>模式添加侦听器，表示<code>listener</code>永远不会调用<code>preventDefault()</code>。</li></ul><h3 id="普通元素" tabindex="-1">普通元素 <a class="header-anchor" href="#普通元素" aria-hidden="true">#</a></h3><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#8B949E;">&lt;!-- 方法处理器 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">v-on:click</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;doThis&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 动态事件 (2.6.0+) --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">v-on:[event]</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;doThis&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 内联语句 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">v-on:click</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;doThat(&#39;param&#39;, $event)&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 缩写 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@click</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;doThis&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 动态事件缩写 (2.6.0+) --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@[event]</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;doThis&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 停止冒泡 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@click.stop</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;doThis&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 阻止默认行为 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@click.prevent</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;doThis&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 阻止默认行为，没有表达式 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">form</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@submit.prevent</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">form</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!--  串联修饰符 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@click.stop.prevent</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;doThis&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 键修饰符，键别名 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">input</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@keyup.enter</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;onEnter&quot;</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 键修饰符，键代码 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">input</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@keyup.13</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;onEnter&quot;</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 点击回调只会触发一次 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">v-on:click.once</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;doThis&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 对象语法 (2.4.0+) --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">v-on</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;{ mousedown: doThis, mouseup: doThat }&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">button</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="组件元素" tabindex="-1">组件元素 <a class="header-anchor" href="#组件元素" aria-hidden="true">#</a></h3><div class="language-html line-numbers-mode"><button class="copy"></button><span class="lang">html</span><pre><code><span class="line"><span style="color:#8B949E;">&lt;!-- 自定义事件 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">my-component</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@my-event</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;handleThis&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">my-component</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 内联语句 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">my-component</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@my-event</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;handleThis(&#39;param&#39;, $event)&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">my-component</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">&lt;!-- 组件中的原生事件 --&gt;</span></span>
<span class="line"><span style="color:#C9D1D9;">&lt;</span><span style="color:#7EE787;">my-component</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">@click.native</span><span style="color:#C9D1D9;">=</span><span style="color:#A5D6FF;">&quot;onClick&quot;</span><span style="color:#C9D1D9;">&gt;&lt;/</span><span style="color:#7EE787;">my-component</span><span style="color:#C9D1D9;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="分析" tabindex="-1">分析 <a class="header-anchor" href="#分析" aria-hidden="true">#</a></h2><p><code>Vue</code>源码的实现比较复杂，会处理各种兼容问题与异常以及各种条件分支，文章分析比较核心的代码部分，精简过后的版本，重要部分做出注释，<code>commit id</code>为<code>ef56410</code>。</p><h3 id="编译阶段" tabindex="-1">编译阶段 <a class="header-anchor" href="#编译阶段" aria-hidden="true">#</a></h3><p><code>Vue</code>在挂载实例前，有相当多的工作是进行模板的编译，将<code>template</code>模板进行编译，解析成<code>AST</code>树，再转换成<code>render</code>函数，而在编译阶段，就是对事件的指令做收集处理。<br> 在<code>template</code>模板中，定义事件的部分是属于<code>XML</code>的<code>Attribute</code>，所以收集指令时需要匹配<code>Attributes</code>以确定哪个<code>Attribute</code>是属于事件。</p><div class="language-javascript line-numbers-mode"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#8B949E;">// dev/src/compiler/parser/index.js line 23</span></span>
<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">onRE</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#A5D6FF;"> /</span><span style="color:#FF7B72;">^</span><span style="color:#A5D6FF;">@</span><span style="color:#FF7B72;">|^</span><span style="color:#A5D6FF;">v-on:/</span></span>
<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">dirRE</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> p<wbr>rocess.env.</span><span style="color:#79C0FF;">VBIND_PROP_SHORTHAND</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">?</span><span style="color:#A5D6FF;"> /</span><span style="color:#FF7B72;">^</span><span style="color:#A5D6FF;">v-</span><span style="color:#FF7B72;">|^</span><span style="color:#A5D6FF;">@</span><span style="color:#FF7B72;">|^</span><span style="color:#A5D6FF;">:</span><span style="color:#FF7B72;">|^</span><span style="color:#7EE787;font-style:italic;">\.</span><span style="color:#FF7B72;">|^</span><span style="color:#A5D6FF;">#/</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">:</span><span style="color:#A5D6FF;"> /</span><span style="color:#FF7B72;">^</span><span style="color:#A5D6FF;">v-</span><span style="color:#FF7B72;">|^</span><span style="color:#A5D6FF;">@</span><span style="color:#FF7B72;">|^</span><span style="color:#A5D6FF;">:</span><span style="color:#FF7B72;">|^</span><span style="color:#A5D6FF;">#/</span></span>
<span class="line"><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">dynamicArgRE</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#A5D6FF;"> /</span><span style="color:#FF7B72;">^</span><span style="color:#7EE787;font-style:italic;">\[</span><span style="color:#79C0FF;">.</span><span style="color:#FF7B72;">*</span><span style="color:#7EE787;font-style:italic;">\]</span><span style="color:#FF7B72;">$</span><span style="color:#A5D6FF;">/</span></span>
<span class="line"><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">bindRE</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#A5D6FF;"> /</span><span style="color:#FF7B72;">^</span><span style="color:#A5D6FF;">:</span><span style="color:#FF7B72;">|^</span><span style="color:#7EE787;font-style:italic;">\.</span><span style="color:#FF7B72;">|^</span><span style="color:#A5D6FF;">v-bind:/</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#8B949E;">// dev/src/compiler/parser/index.js line 757</span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">processAttrs</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">el</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">list</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> el.attrsList</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> i, l, name, rawName, value, modifiers, syncGen, isDynamic</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">for</span><span style="color:#C9D1D9;"> (i </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;">, l </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> list.</span><span style="color:#79C0FF;">length</span><span style="color:#C9D1D9;">; i </span><span style="color:#FF7B72;">&lt;</span><span style="color:#C9D1D9;"> l; i</span><span style="color:#FF7B72;">++</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> rawName </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> list[i].name</span></span>
<span class="line"><span style="color:#C9D1D9;">    value </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> list[i].value</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (dirRE.</span><span style="color:#D2A8FF;">test</span><span style="color:#C9D1D9;">(name)) { </span><span style="color:#8B949E;">// 匹配指令属性</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// mark element as dynamic</span></span>
<span class="line"><span style="color:#C9D1D9;">      el.hasBindings </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">true</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// modifiers</span></span>
<span class="line"><span style="color:#C9D1D9;">      modifiers </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">parseModifiers</span><span style="color:#C9D1D9;">(name.</span><span style="color:#D2A8FF;">replace</span><span style="color:#C9D1D9;">(dirRE, </span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#C9D1D9;">)) </span><span style="color:#8B949E;">// 将修饰符解析</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// support .foo shorthand syntax for the .prop modifier</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (p<wbr>rocess.env.</span><span style="color:#79C0FF;">VBIND_PROP_SHORTHAND</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> propBindRE.</span><span style="color:#D2A8FF;">test</span><span style="color:#C9D1D9;">(name)) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        (modifiers </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> (modifiers </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {})).prop </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">true</span></span>
<span class="line"><span style="color:#C9D1D9;">        name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`.`</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">+</span><span style="color:#C9D1D9;"> name.</span><span style="color:#D2A8FF;">slice</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">1</span><span style="color:#C9D1D9;">).</span><span style="color:#D2A8FF;">replace</span><span style="color:#C9D1D9;">(modifierRE, </span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#C9D1D9;">)</span></span>
<span class="line"><span style="color:#C9D1D9;">      } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (modifiers) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> name.</span><span style="color:#D2A8FF;">replace</span><span style="color:#C9D1D9;">(modifierRE, </span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#C9D1D9;">)</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (bindRE.</span><span style="color:#D2A8FF;">test</span><span style="color:#C9D1D9;">(name)) { </span><span style="color:#8B949E;">// v-bind // 处理v-bind的情况</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">      } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (onRE.</span><span style="color:#D2A8FF;">test</span><span style="color:#C9D1D9;">(name)) { </span><span style="color:#8B949E;">// v-on // 处理事件绑定</span></span>
<span class="line"><span style="color:#C9D1D9;">        name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> name.</span><span style="color:#D2A8FF;">replace</span><span style="color:#C9D1D9;">(onRE, </span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#C9D1D9;">) </span><span style="color:#8B949E;">// 将事件名匹配</span></span>
<span class="line"><span style="color:#C9D1D9;">        isDynamic </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> dynamicArgRE.</span><span style="color:#D2A8FF;">test</span><span style="color:#C9D1D9;">(name) </span><span style="color:#8B949E;">// 动态事件绑定</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (isDynamic) { </span><span style="color:#8B949E;">// 如果是动态事件</span></span>
<span class="line"><span style="color:#C9D1D9;">          name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> name.</span><span style="color:#D2A8FF;">slice</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">1</span><span style="color:#C9D1D9;">, </span><span style="color:#FF7B72;">-</span><span style="color:#79C0FF;">1</span><span style="color:#C9D1D9;">) </span><span style="color:#8B949E;">// 去掉两端的 []</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#D2A8FF;">addHandler</span><span style="color:#C9D1D9;">(el, name, value, modifiers, </span><span style="color:#79C0FF;">false</span><span style="color:#C9D1D9;">, warn, list[i], isDynamic) </span><span style="color:#8B949E;">// 处理事件收集</span></span>
<span class="line"><span style="color:#C9D1D9;">      } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> { </span><span style="color:#8B949E;">// normal directives // 处理其他指令</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// literal attribute // 处理文字属性</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><p>通过<code>addHandler</code>方法，为<code>AST</code>树添加事件相关的属性以及对事件修饰符进行处理。</p><div class="language-javascript line-numbers-mode"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#8B949E;">// dev/src/compiler/helpers.js line 69</span></span>
<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">addHandler</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">el</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">ASTElement</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">name</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">value</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">modifiers</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">?</span><span style="color:#FFA657;">ASTModifiers</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">important</span><span style="color:#FF7B72;">?:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">boolean</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">warn</span><span style="color:#FF7B72;">?:</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">?</span><span style="color:#FFA657;">Function</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">range</span><span style="color:#FF7B72;">?:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Range</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">dynamic</span><span style="color:#FF7B72;">?:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">boolean</span></span>
<span class="line"><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  modifiers </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> modifiers </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> emptyObject</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// passive 和 prevent 不能同时使用，具体是由passive模式的性质决定的</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 详细可以参阅 https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// warn prevent and passive modifier</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">/* istanbul ignore if */</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">    p<wbr>rocess.env.</span><span style="color:#79C0FF;">NODE_ENV</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">!==</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;production&#39;</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> warn </span><span style="color:#FF7B72;">&amp;&amp;</span></span>
<span class="line"><span style="color:#C9D1D9;">    modifiers.prevent </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> modifiers.passive</span></span>
<span class="line"><span style="color:#C9D1D9;">  ) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#D2A8FF;">warn</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#A5D6FF;">&#39;passive and prevent can</span><span style="color:#79C0FF;">\&#39;</span><span style="color:#A5D6FF;">t be used together. &#39;</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">+</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#A5D6FF;">&#39;Passive handler can</span><span style="color:#79C0FF;">\&#39;</span><span style="color:#A5D6FF;">t prevent default event.&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">      range</span></span>
<span class="line"><span style="color:#C9D1D9;">    )</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 标准化click.right和click.middle，因为它们实际上不会触发。</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 从技术上讲，这是特定于浏览器的，但是至少目前来说，浏览器是唯一具有右键/中间点击的目标环境。</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// normalize click.right and click.middle since they don&#39;t actually fire</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// this is technically browser-specific, but at least for now browsers are</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// the only target envs that have right/middle clicks.</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (modifiers.right) { </span><span style="color:#8B949E;">// 将鼠标右键点击标准化 右键点击默认的是 contextmenu 事件</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (dynamic) { </span><span style="color:#8B949E;">// 如果是动态事件</span></span>
<span class="line"><span style="color:#C9D1D9;">      name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`(${</span><span style="color:#C9D1D9;">name</span><span style="color:#A5D6FF;">})===&#39;click&#39;?&#39;contextmenu&#39;:(${</span><span style="color:#C9D1D9;">name</span><span style="color:#A5D6FF;">})`</span><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;">// 动态确定事件名</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (name </span><span style="color:#FF7B72;">===</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;click&#39;</span><span style="color:#C9D1D9;">) { </span><span style="color:#8B949E;">// 如果不是动态事件且是鼠标右击</span></span>
<span class="line"><span style="color:#C9D1D9;">      name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;contextmenu&#39;</span><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;">// 则直接替换为contextmenu事件</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">delete</span><span style="color:#C9D1D9;"> modifiers.right </span><span style="color:#8B949E;">// 删除modifiers的right属性</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (modifiers.middle) { </span><span style="color:#8B949E;">// 同样标准化处理鼠标中键点击的事件</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (dynamic) { </span><span style="color:#8B949E;">// 如果是动态事件</span></span>
<span class="line"><span style="color:#C9D1D9;">      name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`(${</span><span style="color:#C9D1D9;">name</span><span style="color:#A5D6FF;">})===&#39;click&#39;?&#39;mouseup&#39;:(${</span><span style="color:#C9D1D9;">name</span><span style="color:#A5D6FF;">})`</span><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;">// 动态确定事件名</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (name </span><span style="color:#FF7B72;">===</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;click&#39;</span><span style="color:#C9D1D9;">) { </span><span style="color:#8B949E;">// 如果不是动态事件且是鼠标中键点击</span></span>
<span class="line"><span style="color:#C9D1D9;">      name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;mouseup&#39;</span><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;">// 处理为mouseup事件</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 下面是对捕获、一次触发、passive模式的modifiers处理，主要是为事件添加 !、~、&amp; 标记</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 这一部分标记可以在Vue官方文档中查阅 </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// https://cn.vuejs.org/v2/guide/render-function.html#%E4%BA%8B%E4%BB%B6-amp-%E6%8C%89%E9%94%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// check capture modifier</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (modifiers.capture) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">delete</span><span style="color:#C9D1D9;"> modifiers.capture</span></span>
<span class="line"><span style="color:#C9D1D9;">    name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">prependModifierMarker</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;!&#39;</span><span style="color:#C9D1D9;">, name, dynamic)</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (modifiers.once) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">delete</span><span style="color:#C9D1D9;"> modifiers.once</span></span>
<span class="line"><span style="color:#C9D1D9;">    name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">prependModifierMarker</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;~&#39;</span><span style="color:#C9D1D9;">, name, dynamic)</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">/* istanbul ignore if */</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (modifiers.passive) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">delete</span><span style="color:#C9D1D9;"> modifiers.passive</span></span>
<span class="line"><span style="color:#C9D1D9;">    name </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">prependModifierMarker</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;&amp;&#39;</span><span style="color:#C9D1D9;">, name, dynamic)</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// events 用来记录绑定的事件</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> events</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (modifiers.native) { </span><span style="color:#8B949E;">// 如果是要触发根元素原生事件则直接取得nativeEvents</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">delete</span><span style="color:#C9D1D9;"> modifiers.native</span></span>
<span class="line"><span style="color:#C9D1D9;">    events </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> el.nativeEvents </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> (el.nativeEvents </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {})</span></span>
<span class="line"><span style="color:#C9D1D9;">  } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> { </span><span style="color:#8B949E;">// 否则取得events</span></span>
<span class="line"><span style="color:#C9D1D9;">    events </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> el.events </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> (el.events </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {})</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 将事件处理函数作为handler</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">newHandler</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">any</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">rangeSetItem</span><span style="color:#C9D1D9;">({ value: value.</span><span style="color:#D2A8FF;">trim</span><span style="color:#C9D1D9;">(), dynamic }, range)</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (modifiers </span><span style="color:#FF7B72;">!==</span><span style="color:#C9D1D9;"> emptyObject) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    newHandler.modifiers </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> modifiers</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;">// 绑定的事件可以多个，回调也可以多个，最终会合并到数组中</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">handlers</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> events[name]</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">/* istanbul ignore if */</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (Array.</span><span style="color:#D2A8FF;">isArray</span><span style="color:#C9D1D9;">(handlers)) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    important </span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> handlers.</span><span style="color:#D2A8FF;">unshift</span><span style="color:#C9D1D9;">(newHandler) </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> handlers.</span><span style="color:#D2A8FF;">push</span><span style="color:#C9D1D9;">(newHandler)</span></span>
<span class="line"><span style="color:#C9D1D9;">  } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (handlers) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    events[name] </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> important </span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> [newHandler, handlers] </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> [handlers, newHandler]</span></span>
<span class="line"><span style="color:#C9D1D9;">  } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    events[name] </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> newHandler</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  el.plain </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">false</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><h3 id="代码生成" tabindex="-1">代码生成 <a class="header-anchor" href="#代码生成" aria-hidden="true">#</a></h3><p>接下来需要将<code>AST</code>语法树转<code>render</code>函数，在这个过程中会加入对事件的处理，首先模块导出了<code>generate</code>函数，<code>generate</code>函数即会返回<code>render</code>字符串，在这之前会调用<code>genElement</code>函数，而在上述<code>addHandler</code>方法处理的最后执行了<code>el.plain = false</code>，这样在<code>genElement</code>函数中会调用<code>genData</code>函数，而在<code>genData</code>函数中即会调用<code>genHandlers</code>函数。</p><div class="language-javascript line-numbers-mode"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#8B949E;">// dev/src/compiler/codegen/index.js line 42</span></span>
<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">generate</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">ast</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">ASTElement</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">|</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">void</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">options</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">CompilerOptions</span></span>
<span class="line"><span style="color:#C9D1D9;">)</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">CodegenResult</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">state</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">new</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">CodegenState</span><span style="color:#C9D1D9;">(options)</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">code</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> ast </span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genElement</span><span style="color:#C9D1D9;">(ast, state) </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;_c(&quot;div&quot;)&#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    render: </span><span style="color:#A5D6FF;">`with(this){return ${</span><span style="color:#C9D1D9;">code</span><span style="color:#A5D6FF;">}}`</span><span style="color:#C9D1D9;">, </span><span style="color:#8B949E;">// 即render字符串</span></span>
<span class="line"><span style="color:#C9D1D9;">    staticRenderFns: state.staticRenderFns</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/compiler/codegen/index.js line 55</span></span>
<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genElement</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">el</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">ASTElement</span><span style="color:#C9D1D9;">, </span><span style="color:#FFA657;">state</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">CodegenState</span><span style="color:#C9D1D9;">)</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> code</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (el.component) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      code </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genComponent</span><span style="color:#C9D1D9;">(el.component, el, state)</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> data</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#FF7B72;">!</span><span style="color:#C9D1D9;">el.plain </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> (el.pre </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> state.</span><span style="color:#D2A8FF;">maybeComponent</span><span style="color:#C9D1D9;">(el))) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        data </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genData</span><span style="color:#C9D1D9;">(el, state)</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">children</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> el.inlineTemplate </span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">null</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genChildren</span><span style="color:#C9D1D9;">(el, state, </span><span style="color:#79C0FF;">true</span><span style="color:#C9D1D9;">)</span></span>
<span class="line"><span style="color:#C9D1D9;">      code </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`_c(&#39;${</span><span style="color:#C9D1D9;">el</span><span style="color:#A5D6FF;">.</span><span style="color:#C9D1D9;">tag</span><span style="color:#A5D6FF;">}&#39;${</span></span>
<span class="line"><span style="color:#A5D6FF;">        </span><span style="color:#C9D1D9;">data</span><span style="color:#A5D6FF;"> </span><span style="color:#FF7B72;">?</span><span style="color:#A5D6FF;"> </span><span style="color:#A5D6FF;">`,${</span><span style="color:#C9D1D9;">data</span><span style="color:#A5D6FF;">}`</span><span style="color:#A5D6FF;"> </span><span style="color:#FF7B72;">:</span><span style="color:#A5D6FF;"> </span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#A5D6FF;"> </span><span style="color:#8B949E;">// data</span></span>
<span class="line"><span style="color:#A5D6FF;">      </span><span style="color:#A5D6FF;">}${</span></span>
<span class="line"><span style="color:#A5D6FF;">        </span><span style="color:#C9D1D9;">children</span><span style="color:#A5D6FF;"> </span><span style="color:#FF7B72;">?</span><span style="color:#A5D6FF;"> </span><span style="color:#A5D6FF;">`,${</span><span style="color:#C9D1D9;">children</span><span style="color:#A5D6FF;">}`</span><span style="color:#A5D6FF;"> </span><span style="color:#FF7B72;">:</span><span style="color:#A5D6FF;"> </span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#A5D6FF;"> </span><span style="color:#8B949E;">// children</span></span>
<span class="line"><span style="color:#A5D6FF;">      </span><span style="color:#A5D6FF;">})`</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/compiler/codegen/index.js line 219</span></span>
<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genData</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">el</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">ASTElement</span><span style="color:#C9D1D9;">, </span><span style="color:#FFA657;">state</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">CodegenState</span><span style="color:#C9D1D9;">)</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> data </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;{&#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// event handlers</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (el.events) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    data </span><span style="color:#FF7B72;">+=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`${</span><span style="color:#D2A8FF;">genHandlers</span><span style="color:#A5D6FF;">(</span><span style="color:#C9D1D9;">el</span><span style="color:#A5D6FF;">.</span><span style="color:#C9D1D9;">events</span><span style="color:#A5D6FF;">, </span><span style="color:#79C0FF;">false</span><span style="color:#A5D6FF;">)</span><span style="color:#A5D6FF;">},`</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (el.nativeEvents) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    data </span><span style="color:#FF7B72;">+=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`${</span><span style="color:#D2A8FF;">genHandlers</span><span style="color:#A5D6FF;">(</span><span style="color:#C9D1D9;">el</span><span style="color:#A5D6FF;">.</span><span style="color:#C9D1D9;">nativeEvents</span><span style="color:#A5D6FF;">, </span><span style="color:#79C0FF;">true</span><span style="color:#A5D6FF;">)</span><span style="color:#A5D6FF;">},`</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">  data </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> data.</span><span style="color:#D2A8FF;">replace</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">/,</span><span style="color:#FF7B72;">$</span><span style="color:#A5D6FF;">/</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#C9D1D9;">) </span><span style="color:#FF7B72;">+</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;}&#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> data</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/compiler/to-function.js line 12 </span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">createFunction</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">code</span><span style="color:#C9D1D9;">, </span><span style="color:#FFA657;">errors</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">try</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">new</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">Function</span><span style="color:#C9D1D9;">(code) </span><span style="color:#8B949E;">// 将render字符串转为render函数</span></span>
<span class="line"><span style="color:#C9D1D9;">  } </span><span style="color:#FF7B72;">catch</span><span style="color:#C9D1D9;"> (err) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    errors.</span><span style="color:#D2A8FF;">push</span><span style="color:#C9D1D9;">({ err, code })</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> noop</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><p>可以看到无论是处理普通元素事件还是组件根元素原生事件都会调用<code>genHandlers</code>函数，<code>genHandlers</code>函数即会遍历解析好的<code>AST</code>树中事件属性，拿到<code>event</code>对象属性，并根据属性上的事件对象拼接成字符串。</p><div class="language-javascript line-numbers-mode"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#8B949E;">// dev/src/compiler/codegen/events.js line 3</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">fnExpRE</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">/</span><span style="color:#FF7B72;">^</span><span style="color:#A5D6FF;">(</span><span style="color:#79C0FF;">[\w$_]</span><span style="color:#FF7B72;">+|</span><span style="color:#7EE787;font-style:italic;">\(</span><span style="color:#79C0FF;">[</span><span style="color:#FF7B72;">^</span><span style="color:#79C0FF;">)]</span><span style="color:#FF7B72;">*?</span><span style="color:#7EE787;font-style:italic;">\)</span><span style="color:#A5D6FF;">)</span><span style="color:#79C0FF;">\s</span><span style="color:#FF7B72;">*</span><span style="color:#A5D6FF;">=&gt;</span><span style="color:#FF7B72;">|^</span><span style="color:#A5D6FF;">function(?:</span><span style="color:#79C0FF;">\s</span><span style="color:#FF7B72;">+</span><span style="color:#79C0FF;">[\w$]</span><span style="color:#FF7B72;">+</span><span style="color:#A5D6FF;">)</span><span style="color:#FF7B72;">?</span><span style="color:#79C0FF;">\s</span><span style="color:#FF7B72;">*</span><span style="color:#7EE787;font-style:italic;">\(</span><span style="color:#A5D6FF;">/</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">fnInvokeRE</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#A5D6FF;"> /</span><span style="color:#7EE787;font-style:italic;">\(</span><span style="color:#79C0FF;">[</span><span style="color:#FF7B72;">^</span><span style="color:#79C0FF;">)]</span><span style="color:#FF7B72;">*?</span><span style="color:#7EE787;font-style:italic;">\)</span><span style="color:#A5D6FF;">;</span><span style="color:#FF7B72;">*$</span><span style="color:#A5D6FF;">/</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">simplePathRE</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#A5D6FF;"> /</span><span style="color:#FF7B72;">^</span><span style="color:#79C0FF;">[A-Za-z_$][\w$]</span><span style="color:#FF7B72;">*</span><span style="color:#A5D6FF;">(?:</span><span style="color:#7EE787;font-style:italic;">\.</span><span style="color:#79C0FF;">[A-Za-z_$][\w$]</span><span style="color:#FF7B72;">*|</span><span style="color:#7EE787;font-style:italic;">\[</span><span style="color:#A5D6FF;">&#39;</span><span style="color:#79C0FF;">[</span><span style="color:#FF7B72;">^</span><span style="color:#79C0FF;">&#39;]</span><span style="color:#FF7B72;">*?</span><span style="color:#A5D6FF;">&#39;]</span><span style="color:#FF7B72;">|</span><span style="color:#7EE787;font-style:italic;">\[</span><span style="color:#A5D6FF;">&quot;</span><span style="color:#79C0FF;">[</span><span style="color:#FF7B72;">^</span><span style="color:#79C0FF;">&quot;]</span><span style="color:#FF7B72;">*?</span><span style="color:#A5D6FF;">&quot;]</span><span style="color:#FF7B72;">|</span><span style="color:#7EE787;font-style:italic;">\[</span><span style="color:#79C0FF;">\d</span><span style="color:#FF7B72;">+</span><span style="color:#A5D6FF;">]</span><span style="color:#FF7B72;">|</span><span style="color:#7EE787;font-style:italic;">\[</span><span style="color:#79C0FF;">[A-Za-z_$][\w$]</span><span style="color:#FF7B72;">*</span><span style="color:#A5D6FF;">])</span><span style="color:#FF7B72;">*$</span><span style="color:#A5D6FF;">/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/compiler/codegen/events.js line 7</span></span>
<span class="line"><span style="color:#8B949E;">// KeyboardEvent.keyCode aliases</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">keyCodes</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> { [</span><span style="color:#FFA657;">key</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;">]</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">number</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">|</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Array</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">number</span><span style="color:#C9D1D9;">&gt; } </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  esc: </span><span style="color:#79C0FF;">27</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  tab: </span><span style="color:#79C0FF;">9</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  enter: </span><span style="color:#79C0FF;">13</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  space: </span><span style="color:#79C0FF;">32</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  up: </span><span style="color:#79C0FF;">38</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  left: </span><span style="color:#79C0FF;">37</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  right: </span><span style="color:#79C0FF;">39</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  down: </span><span style="color:#79C0FF;">40</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#A5D6FF;">&#39;delete&#39;</span><span style="color:#C9D1D9;">: [</span><span style="color:#79C0FF;">8</span><span style="color:#C9D1D9;">, </span><span style="color:#79C0FF;">46</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"><span style="color:#8B949E;">// KeyboardEvent.key aliases</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">keyNames</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> { [</span><span style="color:#FFA657;">key</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;">]</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">|</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Array</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;">&gt; } </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// #7880: IE11 and Edge use `Esc` for Escape key name.</span></span>
<span class="line"><span style="color:#C9D1D9;">  esc: [</span><span style="color:#A5D6FF;">&#39;Esc&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;Escape&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">  tab: </span><span style="color:#A5D6FF;">&#39;Tab&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  enter: </span><span style="color:#A5D6FF;">&#39;Enter&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// #9112: IE11 uses `Spacebar` for Space key name.</span></span>
<span class="line"><span style="color:#C9D1D9;">  space: [</span><span style="color:#A5D6FF;">&#39; &#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;Spacebar&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// #7806: IE11 uses key names without `Arrow` prefix for arrow keys.</span></span>
<span class="line"><span style="color:#C9D1D9;">  up: [</span><span style="color:#A5D6FF;">&#39;Up&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;ArrowUp&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">  left: [</span><span style="color:#A5D6FF;">&#39;Left&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;ArrowLeft&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">  right: [</span><span style="color:#A5D6FF;">&#39;Right&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;ArrowRight&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">  down: [</span><span style="color:#A5D6FF;">&#39;Down&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;ArrowDown&#39;</span><span style="color:#C9D1D9;">],</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// #9112: IE11 uses `Del` for Delete key name.</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#A5D6FF;">&#39;delete&#39;</span><span style="color:#C9D1D9;">: [</span><span style="color:#A5D6FF;">&#39;Backspace&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;Delete&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;Del&#39;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/compiler/codegen/events.js line 37</span></span>
<span class="line"><span style="color:#8B949E;">// #4868: modifiers that prevent the execution of the listener</span></span>
<span class="line"><span style="color:#8B949E;">// need to explicitly return null so that we can determine whether to remove</span></span>
<span class="line"><span style="color:#8B949E;">// the listener for .once</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">condition</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`if(${</span><span style="color:#C9D1D9;">condition</span><span style="color:#A5D6FF;">})return null;`</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">modifierCode</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> { [</span><span style="color:#FFA657;">key</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;">]</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;"> } </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  stop: </span><span style="color:#A5D6FF;">&#39;$event.stopPropagation();&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  prevent: </span><span style="color:#A5D6FF;">&#39;$event.preventDefault();&#39;</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  self: </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">`$event.target !== $event.currentTarget`</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">  ctrl: </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">`!$event.ctrlKey`</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">  shift: </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">`!$event.shiftKey`</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">  alt: </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">`!$event.altKey`</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">  meta: </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">`!$event.metaKey`</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">  left: </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">`&#39;button&#39; in $event &amp;&amp; $event.button !== 0`</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">  middle: </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">`&#39;button&#39; in $event &amp;&amp; $event.button !== 1`</span><span style="color:#C9D1D9;">),</span></span>
<span class="line"><span style="color:#C9D1D9;">  right: </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">`&#39;button&#39; in $event &amp;&amp; $event.button !== 2`</span><span style="color:#C9D1D9;">)</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/compiler/codegen/events.js line 55</span></span>
<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genHandlers</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">events</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">ASTElementHandlers</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">isNative</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">boolean</span></span>
<span class="line"><span style="color:#C9D1D9;">)</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">prefix</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> isNative </span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;nativeOn:&#39;</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;on:&#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> staticHandlers </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">``</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> dynamicHandlers </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">``</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">for</span><span style="color:#C9D1D9;"> (</span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">name</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">in</span><span style="color:#C9D1D9;"> events) { </span><span style="color:#8B949E;">// 遍历AST解析后的事件属性</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">handlerCode</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genHandler</span><span style="color:#C9D1D9;">(events[name]) </span><span style="color:#8B949E;">// 将事件对象转换成可拼接的字符串</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (events[name] </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> events[name].dynamic) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      dynamicHandlers </span><span style="color:#FF7B72;">+=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`${</span><span style="color:#C9D1D9;">name</span><span style="color:#A5D6FF;">},${</span><span style="color:#C9D1D9;">handlerCode</span><span style="color:#A5D6FF;">},`</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">      staticHandlers </span><span style="color:#FF7B72;">+=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`&quot;${</span><span style="color:#C9D1D9;">name</span><span style="color:#A5D6FF;">}&quot;:${</span><span style="color:#C9D1D9;">handlerCode</span><span style="color:#A5D6FF;">},`</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  staticHandlers </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`{${</span><span style="color:#C9D1D9;">staticHandlers</span><span style="color:#A5D6FF;">.</span><span style="color:#D2A8FF;">slice</span><span style="color:#A5D6FF;">(</span><span style="color:#79C0FF;">0</span><span style="color:#A5D6FF;">, </span><span style="color:#FF7B72;">-</span><span style="color:#79C0FF;">1</span><span style="color:#A5D6FF;">)</span><span style="color:#A5D6FF;">}}`</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (dynamicHandlers) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> prefix </span><span style="color:#FF7B72;">+</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`_d(${</span><span style="color:#C9D1D9;">staticHandlers</span><span style="color:#A5D6FF;">},[${</span><span style="color:#C9D1D9;">dynamicHandlers</span><span style="color:#A5D6FF;">.</span><span style="color:#D2A8FF;">slice</span><span style="color:#A5D6FF;">(</span><span style="color:#79C0FF;">0</span><span style="color:#A5D6FF;">, </span><span style="color:#FF7B72;">-</span><span style="color:#79C0FF;">1</span><span style="color:#A5D6FF;">)</span><span style="color:#A5D6FF;">}])`</span></span>
<span class="line"><span style="color:#C9D1D9;">  } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> prefix </span><span style="color:#FF7B72;">+</span><span style="color:#C9D1D9;"> staticHandlers</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/compiler/codegen/events.js line 96</span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genHandler</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">handler</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">ASTElementHandler</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">|</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Array</span><span style="color:#C9D1D9;">&lt;</span><span style="color:#FFA657;">ASTElementHandler</span><span style="color:#C9D1D9;">&gt;)</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#FF7B72;">!</span><span style="color:#C9D1D9;">handler) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;function(){}&#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 事件绑定可以多个，多个在解析AST树时会以数组的形式存在，如果有多个则会递归调用getHandler方法返回数组。</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (Array.</span><span style="color:#D2A8FF;">isArray</span><span style="color:#C9D1D9;">(handler)) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`[${</span><span style="color:#C9D1D9;">handler</span><span style="color:#A5D6FF;">.</span><span style="color:#D2A8FF;">map</span><span style="color:#A5D6FF;">(</span><span style="color:#79C0FF;">handler</span><span style="color:#A5D6FF;"> </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#A5D6FF;"> </span><span style="color:#D2A8FF;">genHandler</span><span style="color:#A5D6FF;">(</span><span style="color:#C9D1D9;">handler</span><span style="color:#A5D6FF;">)).</span><span style="color:#D2A8FF;">join</span><span style="color:#A5D6FF;">(</span><span style="color:#A5D6FF;">&#39;,&#39;</span><span style="color:#A5D6FF;">)</span><span style="color:#A5D6FF;">}]`</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">isMethodPath</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> simplePathRE.</span><span style="color:#D2A8FF;">test</span><span style="color:#C9D1D9;">(handler.value) </span><span style="color:#8B949E;">// 调用方法为 doThis 型</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">isFunctionExpression</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> fnExpRE.</span><span style="color:#D2A8FF;">test</span><span style="color:#C9D1D9;">(handler.value) </span><span style="color:#8B949E;">// 调用方法为 () =&gt; {} or function() {} 型</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">isFunctionInvocation</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> simplePathRE.</span><span style="color:#D2A8FF;">test</span><span style="color:#C9D1D9;">(handler.value.</span><span style="color:#D2A8FF;">replace</span><span style="color:#C9D1D9;">(fnInvokeRE, </span><span style="color:#A5D6FF;">&#39;&#39;</span><span style="color:#C9D1D9;">)) </span><span style="color:#8B949E;">// 调用方法为 doThis($event) 型</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#FF7B72;">!</span><span style="color:#C9D1D9;">handler.modifiers) { </span><span style="color:#8B949E;">// 没有修饰符</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (isMethodPath </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> isFunctionExpression) { </span><span style="color:#8B949E;">// 符合这两个条件则直接返回</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> handler.value</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">/* istanbul ignore if */</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (__WEEX__ </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> handler.params) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genWeexHandler</span><span style="color:#C9D1D9;">(handler.params, handler.value)</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`function($event){${</span><span style="color:#A5D6FF;"> </span><span style="color:#8B949E;">// 返回拼接的匿名函数的字符串</span></span>
<span class="line"><span style="color:#A5D6FF;">      </span><span style="color:#C9D1D9;">isFunctionInvocation</span><span style="color:#A5D6FF;"> </span><span style="color:#FF7B72;">?</span><span style="color:#A5D6FF;"> </span><span style="color:#A5D6FF;">`return ${</span><span style="color:#C9D1D9;">handler</span><span style="color:#A5D6FF;">.</span><span style="color:#C9D1D9;">value</span><span style="color:#A5D6FF;">}`</span><span style="color:#A5D6FF;"> </span><span style="color:#FF7B72;">:</span><span style="color:#A5D6FF;"> </span><span style="color:#C9D1D9;">handler</span><span style="color:#A5D6FF;">.</span><span style="color:#C9D1D9;">value</span></span>
<span class="line"><span style="color:#A5D6FF;">    </span><span style="color:#A5D6FF;">}}`</span><span style="color:#C9D1D9;"> </span><span style="color:#8B949E;">// inline statement</span></span>
<span class="line"><span style="color:#C9D1D9;">  } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> { </span><span style="color:#8B949E;">// 处理具有修饰符的情况</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> code </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> genModifierCode </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">keys</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> []</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">for</span><span style="color:#C9D1D9;"> (</span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">key</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">in</span><span style="color:#C9D1D9;"> handler.modifiers) {  </span><span style="color:#8B949E;">// 遍历modifiers上记录的修饰符</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (modifierCode[key]) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        genModifierCode </span><span style="color:#FF7B72;">+=</span><span style="color:#C9D1D9;"> modifierCode[key]  </span><span style="color:#8B949E;">// 根据修饰符添加对应js的代码</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// left/right</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (keyCodes[key]) {</span></span>
<span class="line"><span style="color:#C9D1D9;">          keys.</span><span style="color:#D2A8FF;">push</span><span style="color:#C9D1D9;">(key)</span></span>
<span class="line"><span style="color:#C9D1D9;">        }</span></span>
<span class="line"><span style="color:#C9D1D9;">      } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (key </span><span style="color:#FF7B72;">===</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;exact&#39;</span><span style="color:#C9D1D9;">) { </span><span style="color:#8B949E;">// 针对exact的处理</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">modifiers</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">ASTModifiers</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> (handler.modifiers: any)</span></span>
<span class="line"><span style="color:#C9D1D9;">        genModifierCode </span><span style="color:#FF7B72;">+=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genGuard</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">          [</span><span style="color:#A5D6FF;">&#39;ctrl&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;shift&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;alt&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;meta&#39;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"><span style="color:#C9D1D9;">            .</span><span style="color:#D2A8FF;">filter</span><span style="color:#C9D1D9;">(</span><span style="color:#FFA657;">keyModifier</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">!</span><span style="color:#C9D1D9;">modifiers[keyModifier])</span></span>
<span class="line"><span style="color:#C9D1D9;">            .</span><span style="color:#D2A8FF;">map</span><span style="color:#C9D1D9;">(</span><span style="color:#FFA657;">keyModifier</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=&gt;</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`$event.${</span><span style="color:#C9D1D9;">keyModifier</span><span style="color:#A5D6FF;">}Key`</span><span style="color:#C9D1D9;">)</span></span>
<span class="line"><span style="color:#C9D1D9;">            .</span><span style="color:#D2A8FF;">join</span><span style="color:#C9D1D9;">(</span><span style="color:#A5D6FF;">&#39;||&#39;</span><span style="color:#C9D1D9;">)</span></span>
<span class="line"><span style="color:#C9D1D9;">        )</span></span>
<span class="line"><span style="color:#C9D1D9;">      } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">        keys.</span><span style="color:#D2A8FF;">push</span><span style="color:#C9D1D9;">(key) </span><span style="color:#8B949E;">// 如果修饰符不是以上修饰符，则会添加到keys数组中</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (keys.</span><span style="color:#79C0FF;">length</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      code </span><span style="color:#FF7B72;">+=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genKeyFilter</span><span style="color:#C9D1D9;">(keys) </span><span style="color:#8B949E;">// 处理其他修饰符 即keyCodes中定义的修饰符</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">// Make sure modifiers like prevent and stop get executed after key filtering</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (genModifierCode) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      code </span><span style="color:#FF7B72;">+=</span><span style="color:#C9D1D9;"> genModifierCode</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">// 根据三种不同的书写模板返回不同的字符串</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">handlerCode</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> isMethodPath</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`return ${</span><span style="color:#C9D1D9;">handler</span><span style="color:#A5D6FF;">.</span><span style="color:#C9D1D9;">value</span><span style="color:#A5D6FF;">}($event)`</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> isFunctionExpression</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`return (${</span><span style="color:#C9D1D9;">handler</span><span style="color:#A5D6FF;">.</span><span style="color:#C9D1D9;">value</span><span style="color:#A5D6FF;">})($event)`</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> isFunctionInvocation</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`return ${</span><span style="color:#C9D1D9;">handler</span><span style="color:#A5D6FF;">.</span><span style="color:#C9D1D9;">value</span><span style="color:#A5D6FF;">}`</span></span>
<span class="line"><span style="color:#C9D1D9;">          </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> handler.value</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">/* istanbul ignore if */</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (__WEEX__ </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> handler.params) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genWeexHandler</span><span style="color:#C9D1D9;">(handler.params, code </span><span style="color:#FF7B72;">+</span><span style="color:#C9D1D9;"> handlerCode)</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`function($event){${</span><span style="color:#C9D1D9;">code</span><span style="color:#A5D6FF;">}${</span><span style="color:#C9D1D9;">handlerCode</span><span style="color:#A5D6FF;">}}`</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/compiler/codegen/events.js line 175</span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">genFilterCode</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">key</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;">)</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;"> {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">keyVal</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">parseInt</span><span style="color:#C9D1D9;">(key, </span><span style="color:#79C0FF;">10</span><span style="color:#C9D1D9;">)</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (keyVal) { </span><span style="color:#8B949E;">// 如果key是数字，则直接返回$event.keyCode!==${keyVal}</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">`$event.keyCode!==${</span><span style="color:#C9D1D9;">keyVal</span><span style="color:#A5D6FF;">}`</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">keyCode</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> keyCodes[key]</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">keyName</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> keyNames[key]</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 返回_k函数，它的第一个参数是$event.keyCode，</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 第二个参数是key的值，</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 第三个参数就是key在keyCodes中对应的数字。</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#A5D6FF;">`_k($event.keyCode,`</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">+</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#A5D6FF;">`${</span><span style="color:#79C0FF;">JSON</span><span style="color:#A5D6FF;">.</span><span style="color:#D2A8FF;">stringify</span><span style="color:#A5D6FF;">(</span><span style="color:#C9D1D9;">key</span><span style="color:#A5D6FF;">)</span><span style="color:#A5D6FF;">},`</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">+</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#A5D6FF;">`${</span><span style="color:#79C0FF;">JSON</span><span style="color:#A5D6FF;">.</span><span style="color:#D2A8FF;">stringify</span><span style="color:#A5D6FF;">(</span><span style="color:#C9D1D9;">keyCode</span><span style="color:#A5D6FF;">)</span><span style="color:#A5D6FF;">},`</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">+</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#A5D6FF;">`$event.key,`</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">+</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#A5D6FF;">`${</span><span style="color:#79C0FF;">JSON</span><span style="color:#A5D6FF;">.</span><span style="color:#D2A8FF;">stringify</span><span style="color:#A5D6FF;">(</span><span style="color:#C9D1D9;">keyName</span><span style="color:#A5D6FF;">)</span><span style="color:#A5D6FF;">}`</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">+</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#A5D6FF;">`)`</span></span>
<span class="line"><span style="color:#C9D1D9;">  )</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br></div></div><h3 id="事件绑定" tabindex="-1">事件绑定 <a class="header-anchor" href="#事件绑定" aria-hidden="true">#</a></h3><p>前面介绍了如何编译模板提取事件收集指令以及生成<code>render</code>字符串和<code>render</code>函数，但是事件真正的绑定到<code>DOM</code>上还是离不开事件注册，此阶段就发生在<code>patchVnode</code>过程中，在生成完成<code>VNode</code>后，进行<code>patchVnode</code>过程中创建真实<code>DOM</code>时会进行事件注册的相关钩子处理。</p><div class="language-javascript line-numbers-mode"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#8B949E;">// dev/src/core/vdom/patch.js line 33</span></span>
<span class="line"><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">hooks</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> [</span><span style="color:#A5D6FF;">&#39;create&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;activate&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;update&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;remove&#39;</span><span style="color:#C9D1D9;">, </span><span style="color:#A5D6FF;">&#39;destroy&#39;</span><span style="color:#C9D1D9;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/core/vdom/patch.js line 125</span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">createElm</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FFA657;">vnode</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FFA657;">insertedVnodeQueue</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FFA657;">parentElm</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FFA657;">refElm</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FFA657;">nested</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FFA657;">ownerArray</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FFA657;">index</span></span>
<span class="line"><span style="color:#C9D1D9;">  ) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isDef</span><span style="color:#C9D1D9;">(data)) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#D2A8FF;">invokeCreateHooks</span><span style="color:#C9D1D9;">(vnode, insertedVnodeQueue)</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// ...</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/core/vdom/patch.js line 303</span></span>
<span class="line"><span style="color:#8B949E;">// 在之前cbs经过处理 </span></span>
<span class="line"><span style="color:#8B949E;">// 这里cbs.create包含如下几个回调：</span></span>
<span class="line"><span style="color:#8B949E;">// updateAttrs、updateClass、updateDOMListeners、updateDOMProps、updateStyle、update、updateDirectives</span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">invokeCreateHooks</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">vnode</span><span style="color:#C9D1D9;">, </span><span style="color:#FFA657;">insertedVnodeQueue</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">for</span><span style="color:#C9D1D9;"> (</span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> i </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;">; i </span><span style="color:#FF7B72;">&lt;</span><span style="color:#C9D1D9;"> cbs.create.</span><span style="color:#79C0FF;">length</span><span style="color:#C9D1D9;">; </span><span style="color:#FF7B72;">++</span><span style="color:#C9D1D9;">i) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      cbs.create[i](emptyNode, vnode)</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    i </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> vnode.data.hook </span><span style="color:#8B949E;">// Reuse variable</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isDef</span><span style="color:#C9D1D9;">(i)) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isDef</span><span style="color:#C9D1D9;">(i.create)) i.</span><span style="color:#D2A8FF;">create</span><span style="color:#C9D1D9;">(emptyNode, vnode)</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isDef</span><span style="color:#C9D1D9;">(i.insert)) insertedVnodeQueue.</span><span style="color:#D2A8FF;">push</span><span style="color:#C9D1D9;">(vnode)</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><code>invokeCreateHooks</code>就是一个模板指令处理的任务，他分别针对不同的指令为真实阶段创建不同的任务，针对事件，这里会调<code>updateDOMListeners</code>对真实的<code>DOM</code>节点注册事件任务。</p><div class="language-javascript line-numbers-mode"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#8B949E;">// dev/src/platforms/web/runtime/modules/events.js line 105</span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">updateDOMListeners</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">oldVnode</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">VNodeWithData</span><span style="color:#C9D1D9;">, </span><span style="color:#FFA657;">vnode</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">VNodeWithData</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isUndef</span><span style="color:#C9D1D9;">(oldVnode.data.on) </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">isUndef</span><span style="color:#C9D1D9;">(vnode.data.on)) {  </span><span style="color:#8B949E;">// on是事件指令的标志</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">return</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 新旧节点不同的事件绑定解绑</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">on</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> vnode.data.on </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> {}</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">oldOn</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> oldVnode.data.on </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> {}</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 拿到需要添加事件的真实DOM节点</span></span>
<span class="line"><span style="color:#C9D1D9;">  target </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> vnode.elm</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// normalizeEvents是对事件兼容性的处理</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#D2A8FF;">normalizeEvents</span><span style="color:#C9D1D9;">(on)</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// 调用updateListeners方法，并将on作为参数传进去</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#D2A8FF;">updateListeners</span><span style="color:#C9D1D9;">(on, oldOn, add, remove, createOnceHandler, vnode.context)</span></span>
<span class="line"><span style="color:#C9D1D9;">  target </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">undefined</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/core/vdom/helpers/update-listeners.js line line 53</span></span>
<span class="line"><span style="color:#FF7B72;">export</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">updateListeners</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">on</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Object</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">oldOn</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Object</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#D2A8FF;">add</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Function</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#D2A8FF;">remove</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Function</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#D2A8FF;">createOnceHandler</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Function</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">vm</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Component</span></span>
<span class="line"><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">let</span><span style="color:#C9D1D9;"> name, def, cur, old, event</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">for</span><span style="color:#C9D1D9;"> (name </span><span style="color:#FF7B72;">in</span><span style="color:#C9D1D9;"> on) { </span><span style="color:#8B949E;">// 遍历事件</span></span>
<span class="line"><span style="color:#C9D1D9;">    def </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> cur </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> on[name]</span></span>
<span class="line"><span style="color:#C9D1D9;">    old </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> oldOn[name]</span></span>
<span class="line"><span style="color:#C9D1D9;">    event </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">normalizeEvent</span><span style="color:#C9D1D9;">(name)</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#8B949E;">/* istanbul ignore if */</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (__WEEX__ </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">isPlainObject</span><span style="color:#C9D1D9;">(def)) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      cur </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> def.handler</span></span>
<span class="line"><span style="color:#C9D1D9;">      event.params </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> def.params</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isUndef</span><span style="color:#C9D1D9;">(cur)) { </span><span style="color:#8B949E;">// 事件名非法的报错处理</span></span>
<span class="line"><span style="color:#C9D1D9;">      p<wbr>rocess.env.</span><span style="color:#79C0FF;">NODE_ENV</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">!==</span><span style="color:#C9D1D9;"> </span><span style="color:#A5D6FF;">&#39;production&#39;</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">&amp;&amp;</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">warn</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#A5D6FF;">`Invalid handler for event &quot;${</span><span style="color:#C9D1D9;">event</span><span style="color:#A5D6FF;">.</span><span style="color:#C9D1D9;">name</span><span style="color:#A5D6FF;">}&quot;: got `</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">+</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">String</span><span style="color:#C9D1D9;">(cur),</span></span>
<span class="line"><span style="color:#C9D1D9;">        vm</span></span>
<span class="line"><span style="color:#C9D1D9;">      )</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isUndef</span><span style="color:#C9D1D9;">(old)) { </span><span style="color:#8B949E;">// 旧节点不存在</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isUndef</span><span style="color:#C9D1D9;">(cur.fns)) { </span><span style="color:#8B949E;">// createFunInvoker返回事件最终执行的回调函数</span></span>
<span class="line"><span style="color:#C9D1D9;">        cur </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> on[name] </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">createFnInvoker</span><span style="color:#C9D1D9;">(cur, vm)</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isTrue</span><span style="color:#C9D1D9;">(event.once)) {  </span><span style="color:#8B949E;">// 只触发一次的事件</span></span>
<span class="line"><span style="color:#C9D1D9;">        cur </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> on[name] </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">createOnceHandler</span><span style="color:#C9D1D9;">(event.name, cur, event.capture)</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// 执行真正注册事件的执行函数</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#D2A8FF;">add</span><span style="color:#C9D1D9;">(event.name, cur, event.capture, event.passive, event.params)</span></span>
<span class="line"><span style="color:#C9D1D9;">    } </span><span style="color:#FF7B72;">else</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (cur </span><span style="color:#FF7B72;">!==</span><span style="color:#C9D1D9;"> old) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      old.fns </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> cur</span></span>
<span class="line"><span style="color:#C9D1D9;">      on[name] </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> old</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">for</span><span style="color:#C9D1D9;"> (name </span><span style="color:#FF7B72;">in</span><span style="color:#C9D1D9;"> oldOn) { </span><span style="color:#8B949E;">// 旧节点存在，解除旧节点上的绑定事件</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span><span style="color:#D2A8FF;">isUndef</span><span style="color:#C9D1D9;">(on[name])) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      event </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">normalizeEvent</span><span style="color:#C9D1D9;">(name)</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#8B949E;">// 移除事件监听</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#D2A8FF;">remove</span><span style="color:#C9D1D9;">(event.name, oldOn[name], event.capture)</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/platforms/web/runtime/modules/events.js line 32</span></span>
<span class="line"><span style="color:#8B949E;">// 在执行完回调之后，移除事件绑定</span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">createOnceHandler</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">event</span><span style="color:#C9D1D9;">, </span><span style="color:#FFA657;">handler</span><span style="color:#C9D1D9;">, </span><span style="color:#FFA657;">capture</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">_target</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> target </span><span style="color:#8B949E;">// save current target element in closure</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">onceHandler</span><span style="color:#C9D1D9;"> () {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">res</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> handler.</span><span style="color:#D2A8FF;">apply</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">null</span><span style="color:#C9D1D9;">, </span><span style="color:#79C0FF;">arguments</span><span style="color:#C9D1D9;">)</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (res </span><span style="color:#FF7B72;">!==</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">null</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#D2A8FF;">remove</span><span style="color:#C9D1D9;">(event, onceHandler, capture, _target)</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><p>最终添加与移除事件都是调用的<code>add</code>与<code>remove</code>方法，最终调用的方法即<code>DOM</code>的<code>addEventListener</code>方法与<code>removeEventListener</code>方法。</p><div class="language-javascript line-numbers-mode"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#8B949E;">// dev/src/platforms/web/runtime/modules/events.js line 46</span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">add</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">name</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#D2A8FF;">handler</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Function</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">capture</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">boolean</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">passive</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">boolean</span></span>
<span class="line"><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// async edge case #6566: inner click event triggers patch, event handler</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// attached to outer element during patch, and triggered again. This</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// happens because browsers fire microtask ticks between event propagation.</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// the solution is simple: we save the timestamp when a handler is attached,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// and the handler would only fire if the event passed to it was fired</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#8B949E;">// AFTER it was attached.</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (useMicrotaskFix) {</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">attachedTimestamp</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> currentFlushTimestamp</span></span>
<span class="line"><span style="color:#C9D1D9;">    </span><span style="color:#FF7B72;">const</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">original</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> handler</span></span>
<span class="line"><span style="color:#C9D1D9;">    handler </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> original.</span><span style="color:#D2A8FF;">_wrapper</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">=</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> (</span><span style="color:#FFA657;">e</span><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">if</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// no bubbling, should always fire.</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// this is just a safety net in case event.timeStamp is unreliable in</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// certain weird environments...</span></span>
<span class="line"><span style="color:#C9D1D9;">        e.target </span><span style="color:#FF7B72;">===</span><span style="color:#C9D1D9;"> e.currentTarget </span><span style="color:#FF7B72;">||</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// event is fired after handler attachment</span></span>
<span class="line"><span style="color:#C9D1D9;">        e.timeStamp </span><span style="color:#FF7B72;">&gt;=</span><span style="color:#C9D1D9;"> attachedTimestamp </span><span style="color:#FF7B72;">||</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// bail for environments that have buggy event.timeStamp implementations</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// #9462 iOS 9 bug: event.timeStamp is 0 after history.pushState</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// #9681 QtWebEngine event.timeStamp is negative value</span></span>
<span class="line"><span style="color:#C9D1D9;">        e.timeStamp </span><span style="color:#FF7B72;">&lt;=</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">0</span><span style="color:#C9D1D9;"> </span><span style="color:#FF7B72;">||</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// #9448 bail if event is fired in another document in a multi-page</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// electron/nw.js app, since event.timeStamp will be using a different</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#8B949E;">// starting reference</span></span>
<span class="line"><span style="color:#C9D1D9;">        e.target.ownerDocument </span><span style="color:#FF7B72;">!==</span><span style="color:#C9D1D9;"> document</span></span>
<span class="line"><span style="color:#C9D1D9;">      ) {</span></span>
<span class="line"><span style="color:#C9D1D9;">        </span><span style="color:#FF7B72;">return</span><span style="color:#C9D1D9;"> original.</span><span style="color:#D2A8FF;">apply</span><span style="color:#C9D1D9;">(</span><span style="color:#79C0FF;">this</span><span style="color:#C9D1D9;">, </span><span style="color:#79C0FF;">arguments</span><span style="color:#C9D1D9;">)</span></span>
<span class="line"><span style="color:#C9D1D9;">      }</span></span>
<span class="line"><span style="color:#C9D1D9;">    }</span></span>
<span class="line"><span style="color:#C9D1D9;">  }</span></span>
<span class="line"><span style="color:#C9D1D9;">  target.</span><span style="color:#D2A8FF;">addEventListener</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">    name,</span></span>
<span class="line"><span style="color:#C9D1D9;">    handler,</span></span>
<span class="line"><span style="color:#C9D1D9;">    supportsPassive</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">?</span><span style="color:#C9D1D9;"> { capture, passive }</span></span>
<span class="line"><span style="color:#C9D1D9;">      </span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> capture</span></span>
<span class="line"><span style="color:#C9D1D9;">  )</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8B949E;">// dev/src/platforms/web/runtime/modules/events.js line 92</span></span>
<span class="line"><span style="color:#FF7B72;">function</span><span style="color:#C9D1D9;"> </span><span style="color:#D2A8FF;">remove</span><span style="color:#C9D1D9;"> (</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">name</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">string</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#D2A8FF;">handler</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">Function</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">capture</span><span style="color:#FF7B72;">:</span><span style="color:#C9D1D9;"> </span><span style="color:#79C0FF;">boolean</span><span style="color:#C9D1D9;">,</span></span>
<span class="line"><span style="color:#C9D1D9;">  </span><span style="color:#FFA657;">_target</span><span style="color:#FF7B72;">?:</span><span style="color:#C9D1D9;"> </span><span style="color:#FFA657;">HTMLElement</span></span>
<span class="line"><span style="color:#C9D1D9;">) {</span></span>
<span class="line"><span style="color:#C9D1D9;">  (_target </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> target).</span><span style="color:#D2A8FF;">removeEventListener</span><span style="color:#C9D1D9;">(</span></span>
<span class="line"><span style="color:#C9D1D9;">    name,</span></span>
<span class="line"><span style="color:#C9D1D9;">    handler._wrapper </span><span style="color:#FF7B72;">||</span><span style="color:#C9D1D9;"> handler,</span></span>
<span class="line"><span style="color:#C9D1D9;">    capture</span></span>
<span class="line"><span style="color:#C9D1D9;">  )</span></span>
<span class="line"><span style="color:#C9D1D9;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-hidden="true">#</a></h2><div class="language- line-numbers-mode"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#c9d1d9;">https://cn.vuejs.org/v2/api/#v-on</span></span>
<span class="line"><span style="color:#c9d1d9;">https://juejin.im/post/6844903919290679304</span></span>
<span class="line"><span style="color:#c9d1d9;">https://juejin.im/post/6844904061897015310</span></span>
<span class="line"><span style="color:#c9d1d9;">https://juejin.im/post/6844904126250221576</span></span>
<span class="line"><span style="color:#c9d1d9;">https://segmentfault.com/a/1190000009750348</span></span>
<span class="line"><span style="color:#c9d1d9;">https://blog.csdn.net/weixin_41275295/article/details/100549145</span></span>
<span class="line"><span style="color:#c9d1d9;">https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener</span></span>
<span class="line"><span style="color:#c9d1d9;">https://github.com/liutao/vue2.0-source/blob/master/%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86.md</span></span>
<span class="line"><span style="color:#c9d1d9;"></span></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></div></main><!--[--><!--]--><footer class="VPDocFooter" data-v-f0af2311 data-v-a54a85bd><div class="edit-info" data-v-a54a85bd><!----><div class="last-updated" data-v-a54a85bd><p class="VPLastUpdated" data-v-a54a85bd data-v-f7d51a9c>最近更新时间: <time datatime="2024-08-18T01:34:12.000Z" data-v-f7d51a9c></time></p></div></div><div class="prev-next" data-v-a54a85bd><div class="pager" data-v-a54a85bd><a class="pager-link prev" href="/comK/frontend/Vue/Vue%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd> 上一页 </span><span class="title" data-v-a54a85bd>Vue生命周期</span></a></div><div class="has-prev pager" data-v-a54a85bd><a class="pager-link next" href="/comK/frontend/Vue/Vue%E9%A6%96%E5%B1%8F%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%BB%84%E4%BB%B6.html" data-v-a54a85bd><span class="desc" data-v-a54a85bd> 下一页 </span><span class="title" data-v-a54a85bd>Vue首屏性能优化组件</span></a></div></div></footer><!--[--><!--]--></div></div></div></div></div><footer class="VPFooter has-sidebar" data-v-ca9ccb7e data-v-9f24cc86><div class="container" data-v-9f24cc86><p class="message" data-v-9f24cc86>Released under the MIT License.</p><p class="copyright" data-v-9f24cc86>Copyright © 2022-present wxf</p></div></footer><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"pluginextension_tuieditor_index.md\":\"0030f23a\",\"backend_javase_index.md\":\"aea5e1b6\",\"backend_maven_index.md\":\"62b0acbd\",\"frontend_html_300ms点击延迟.md\":\"99e21b01\",\"frontend_html_attribute和property的区别.md\":\"c921be10\",\"frontend_html_canvas基础.md\":\"9d1e38f2\",\"frontend_html_cookie与session.md\":\"94ceb305\",\"frontend_html_dom和bom的区别.md\":\"b9229a57\",\"frontend_html_html与xhtml区别.md\":\"0ce6e569\",\"frontend_html_html节点操作.md\":\"a16ad9ee\",\"frontend_html_iframe框架及优缺点.md\":\"28131477\",\"frontend_html_localstorage与sessionstorage.md\":\"7f0a6f13\",\"frontend_html_service worker的应用.md\":\"b4e7e1ac\",\"frontend_html_shadow dom的理解.md\":\"a1599a14\",\"frontend_html_web worker.md\":\"b7a5ec42\",\"frontend_html_index.md\":\"02606e6c\",\"frontend_html_前端性能优化方案.md\":\"581e898f\",\"frontend_html_可替换元素和非替换元素.md\":\"c3d56a8f\",\"frontend_html_图片等比例缩放方案.md\":\"7e963c7f\",\"frontend_html_实现三栏布局.md\":\"4554c5b3\",\"frontend_html_实现加载提示组件.md\":\"eb4473f9\",\"frontend_html_实现图片懒加载.md\":\"bdec0cb8\",\"frontend_html_实现拼图滑动验证码.md\":\"495afa8c\",\"frontend_html_实现消息提示组件.md\":\"b7da3b4a\",\"frontend_html_实现瀑布流布局.md\":\"d20ba659\",\"frontend_html_手动实现轮播图功能.md\":\"2b549b7b\",\"frontend_html_蒙层禁止页面滚动的方案.md\":\"3a7f91bf\",\"frontend_html_行内元素和块级元素.md\":\"212c3b1b\",\"frontend_html_默认行为及阻止.md\":\"05054d8d\",\"frontend_node_index.md\":\"d90ab25e\",\"frontend_pinia_index.md\":\"3a02f348\",\"frontend_vue_mvvm模式的理解.md\":\"83cb18dd\",\"frontend_vue_spa单页应用的优缺点.md\":\"efadd364\",\"frontend_vue_vue3.0新特性.md\":\"49f98a3c\",\"frontend_vue_vuerouter导航守卫.md\":\"cab81646\",\"frontend_vue_vuex中的核心方法.md\":\"fb7e5a22\",\"frontend_vue_vuex和普通全局对象.md\":\"8f6e7090\",\"frontend_vue_vue中computed分析.md\":\"4bf4e0f8\",\"frontend_vue_vue中diff算法的理解.md\":\"bbb3464a\",\"frontend_vue_vue中key的作用.md\":\"f72294f0\",\"frontend_vue_vue中nexttick的理解.md\":\"1ed351e8\",\"frontend_vue_vue中refs的理解.md\":\"12a9ffd3\",\"frontend_vue_vue中数组变动监听.md\":\"ae74f163\",\"frontend_vue_vue中的三种watcher.md\":\"3d4c9155\",\"frontend_vue_vue中组件间通信的方式.md\":\"aa1bfe5d\",\"frontend_vue_vue中虚拟dom的理解.md\":\"4c4be670\",\"frontend_vue_vue为何采用异步渲染.md\":\"3e0700bd\",\"frontend_vue_vue事件绑定原理.md\":\"7319177a\",\"frontend_vue_vue常用性能优化.md\":\"7960322c\",\"frontend_vue_vue数据双向绑定.md\":\"aed064d5\",\"frontend_vue_vue父子组件生命周期.md\":\"11fa88ad\",\"frontend_vue_vue生命周期.md\":\"91bd44c3\",\"frontend_vue_vue路由hash模式分析.md\":\"96aedadb\",\"frontend_vue_vue路由history模式分析.md\":\"c9a929a8\",\"frontend_vue_vue路由懒加载.md\":\"49f1e09e\",\"frontend_vue_vue首屏性能优化组件.md\":\"db1632dc\",\"frontend_vue_data为何以函数形式返回.md\":\"59d86cb9\",\"frontend_vue_index.md\":\"72a7cb3c\",\"frontend_vue_v-html可能导致的问题.md\":\"95b09b94\",\"frontend_vue_v-if与v-show的区别.md\":\"62a1c0b0\",\"frontend_vue_v-model数据绑定分析.md\":\"75fec827\",\"frontend_vue_对keep-alive组件的理解.md\":\"2bed5dcf\",\"frontend_vue_服务端渲染ssr的理解.md\":\"ac2d41f0\",\"frontend_webpack_basic.md\":\"d3becd5e\",\"frontend_webpack_support.md\":\"0df8feea\",\"frontend_webpack_usesteps.md\":\"ee1c519e\",\"index.md\":\"819a0748\",\"personal_start.md\":\"9a06ac15\",\"toolsoftware_linux_aspell命令.md\":\"7c09d77e\",\"toolsoftware_linux_awk命令.md\":\"7a24403d\",\"toolsoftware_linux_chattr命令.md\":\"b8f97308\",\"toolsoftware_linux_chmod命令.md\":\"bf4d79d0\",\"toolsoftware_linux_chown命令.md\":\"23b701b7\",\"toolsoftware_linux_cmp命令.md\":\"fe8458ad\",\"toolsoftware_linux_colrm命令.md\":\"e07685ed\",\"toolsoftware_linux_col命令.md\":\"0385b7d9\",\"toolsoftware_linux_comm命令.md\":\"422cd163\",\"toolsoftware_linux_csplit命令.md\":\"8df0fe06\",\"toolsoftware_linux_curl命令.md\":\"c05f1fd4\",\"toolsoftware_linux_cut命令.md\":\"618b8e57\",\"toolsoftware_linux_diffstat命令.md\":\"7c28ac6b\",\"toolsoftware_linux_diff命令.md\":\"caf62c65\",\"toolsoftware_linux_ed命令.md\":\"b9863bb3\",\"toolsoftware_linux_egrep命令.md\":\"fd74097f\",\"toolsoftware_linux_expr命令.md\":\"1e7b7b3f\",\"toolsoftware_linux_ex命令.md\":\"838f0066\",\"toolsoftware_linux_fgrep命令.md\":\"0b49cc95\",\"toolsoftware_linux_file命令.md\":\"82c92acb\",\"toolsoftware_linux_find命令.md\":\"444784a6\",\"toolsoftware_linux_fmt命令.md\":\"2fe826c2\",\"toolsoftware_linux_fold命令.md\":\"6535a6b2\",\"toolsoftware_linux_grep命令.md\":\"cb3d1f2c\",\"toolsoftware_linux_index.md\":\"f860a9dd\",\"toolsoftware_linux_ip命令.md\":\"e65e88ac\",\"toolsoftware_linux_join命令.md\":\"26de81de\",\"toolsoftware_linux_journalctl命令.md\":\"d4c09cba\",\"toolsoftware_linux_less命令.md\":\"dc830ab0\",\"toolsoftware_linux_ln命令.md\":\"9a293412\",\"toolsoftware_linux_locate命令.md\":\"c573091d\",\"toolsoftware_linux_look命令.md\":\"4b8ec859\",\"toolsoftware_linux_lsattr命令.md\":\"ad0405ed\",\"toolsoftware_linux_mc命令.md\":\"78a07c19\",\"toolsoftware_linux_more命令.md\":\"a82fe005\",\"toolsoftware_linux_mv命令.md\":\"e0812cea\",\"toolsoftware_linux_netstat命令.md\":\"43c8f870\",\"toolsoftware_linux_od命令.md\":\"3baf3913\",\"toolsoftware_linux_paste命令.md\":\"0c45be47\",\"toolsoftware_linux_patch命令.md\":\"a6d9698d\",\"toolsoftware_linux_pico命令.md\":\"b5c9b8f2\",\"toolsoftware_linux_ps命令.md\":\"d9f04539\",\"toolsoftware_linux_rcp命令.md\":\"0c80d396\",\"toolsoftware_linux_read命令.md\":\"28a83faf\",\"toolsoftware_linux_rm命令.md\":\"19a3a814\",\"toolsoftware_linux_scp命令.md\":\"75bd8957\",\"toolsoftware_linux_sed命令.md\":\"d5e16b3b\",\"toolsoftware_linux_sort命令.md\":\"c5ae099c\",\"toolsoftware_linux_split命令.md\":\"7d6a7a3c\",\"toolsoftware_linux_systemctl命令.md\":\"e8aa2298\",\"toolsoftware_linux_tee命令.md\":\"a1a4d6aa\",\"toolsoftware_linux_tmpwatch命令.md\":\"574cf072\",\"toolsoftware_linux_top命令.md\":\"f078cf15\",\"toolsoftware_linux_touch命令.md\":\"0e947e6d\",\"toolsoftware_linux_traceroute命令.md\":\"9f0ee746\",\"toolsoftware_linux_tr命令.md\":\"49c1ebd2\",\"toolsoftware_linux_umask命令.md\":\"7dd287c3\",\"toolsoftware_linux_updatedb命令.md\":\"4042bc64\",\"toolsoftware_linux_whereis命令.md\":\"97737abc\",\"toolsoftware_linux_which命令.md\":\"dae01ea1\"}")</script>
    <script type="module" async src="/comK/assets/app.02c23f2e.js"></script>
    
  </body>
</html>